// For format details, see https://aka.ms/devcontainer.json. For config options, see the
// README at: https://github.com/devcontainers/templates/tree/main/src/ubuntu
{
    // "name": "Ubuntu",
    "name": "devbox",
    // Or use a Dockerfile or Docker Compose file. More info: https://containers.dev/guide/dockerfile
    "image": "mcr.microsoft.com/devcontainers/base:noble",
    // Features to add to the dev container. More info: https://containers.dev/features.
    "features": {
        "ghcr.io/devcontainers/features/aws-cli:1": {
            "version": "latest"
        },
        "ghcr.io/devcontainers/features/docker-in-docker:2": {
            "version": "latest",
            "dockerDashComposeVersion": "v2"
        },
        "ghcr.io/devcontainers/features/git:1": {
            "ppa": true,
            "version": "latest"
        },
        "ghcr.io/devcontainers/features/github-cli:1": {
            "installDirectlyFromGitHubRelease": true,
            "version": "latest"
        },
        "ghcr.io/devcontainers/features/node:1": {
            "version": "24",
            "pnpmVersion": "latest",
            "nvmVersion": "latest"
        },
        "ghcr.io/devcontainers/features/python:1": {
            "installTools": true,
            "version": "3.12"
        },
        "ghcr.io/devcontainer-community/devcontainer-features/astral.sh-uv:1": {
            "shellautocompletion": true,
            "version": "latest"
        },
        "ghcr.io/devcontainers-extra/features/aws-cdk:2": {},
        "ghcr.io/anthropics/devcontainer-features/claude-code:1.0": {},
        "ghcr.io/devcontainers-extra/features/uv:1": {}
    },
    // Use 'forwardPorts' to make a list of ports inside the container available locally.
    // "forwardPorts": [],
    // Use 'postCreateCommand' to run commands after the container is created.
    "initializeCommand": "uname -a",
    "postCreateCommand": "sudo chown -R vscode:vscode /usr/local/share/nvm/* && npm install -g yarn pnpm git-cz @biomejs/biome@2.3.11 aws-cdk @anthropic-ai/claude-code @openai/codex",
    "postStartCommand": "uname -a",
    // Set environment variables for the container.
    "containerEnv": {
        "NEXT_TELEMETRY_DISABLED": "1"
    },
    // Add environment variables to VS Code.
    "remoteEnv": {},
    "mounts": [
        // Shared credentials for AWS CLI/Azure CLI with Windows/WSL2.
        "source=${localEnv:HOME}${localEnv:USERPROFILE}/.aws,target=/home/vscode/.aws,type=bind,consistency=cached",
        "source=${localEnv:HOME}${localEnv:USERPROFILE}/.azure,target=/home/vscode/.azure,type=bind,consistency=cached",
        // Share settings for Claude Code/Codex CLI with Windows/WSL2.
        "source=${localEnv:HOME}${localEnv:USERPROFILE}/.claude,target=/home/vscode/.claude,type=bind,consistency=cached",
        "source=${localEnv:HOME}${localEnv:USERPROFILE}/.codex,target=/home/vscode/.codex,type=bind,consistency=cached",
        // Cache for packages.
        "source=${localWorkspaceFolderBasename}-pnpm-pkgs,target=${containerWorkspaceFolder}/.pnpm-store,type=volume",
        "source=${localWorkspaceFolderBasename}-venv-pkgs,target=${containerWorkspaceFolder}/agent/.venv,type=volume",
        // Cache for Serena MCP.
        "source=${localWorkspaceFolderBasename}-serena,target=${containerWorkspaceFolder}/.serena/cache,type=volume"
    ],
    // Configure tool-specific properties.
    "customizations": {
        "vscode": {
            "extensions": [
                // ===============
                // 基本拡張機能
                // ===============
                // "VisualStudioExptTeam.vscodeintellicode", // AIアシスト
                "ms-vsliveshare.vsliveshare", // コラボレーション
                "ms-vscode.copilot-mermaid-diagram",
                "vstirbu.vscode-mermaid-preview",
                "github.copilot", // Copilot Chat
                "github.copilot-chat", // Copilot Chat
                // ===============
                // コーディングエージェント
                // ===============
                "saoudrizwan.claude-dev", // Cline
                "anthropic.claude-code", // Claude Code
                "openai.chatgpt", // Codex
                // "continue.continue", // Continue
                // "tabnine.tabnine-vscode", // Tabnine
                // ===============
                // Python向け拡張機能
                // ===============
                "charliermarsh.ruff", // Formatter/Linter
                "ms-python.python", // Language support
                "ms-python.vscode-pylance", // Language server
                "ms-python.debugpy", // Debugger
                "njpwerner.autodocstring", // Docstring support
                // ==============
                // JavaScript/TypeScript向け拡張機能
                // ==============
                // "dbaeumer.vscode-eslint", // Linter
                // "esbenp.prettier-vscode", // Formatter
                "biomejs.biome", // Linter/Formatter
                "xabikos.JavaScriptSnippets", // Code Snippets
                // "yoavbls.pretty-ts-errors", // Pretty Error messages for Typescript
                "crystal-spider.jsdoc-generator", // JSDoc generator
                "formulahendry.auto-rename-tag", // Auto rename tag for HTML
                "formulahendry.auto-close-tag", // Auto close tag for HTML
                "dsznajder.es7-react-js-snippets", // Code Snippets for React.js
                "PulkitGangwar.nextjs-snippets", // Code Snippets for Next.js
                "nextnav.nextnav", // Route Visualizer for Next.js
                "bradlc.vscode-tailwindcss",
                "wix.vscode-import-cost", // Package Size Checker for npm
                // ==============
                // MISC
                // ==============
                "github.vscode-github-actions", // GitHub Actions support
                "gitlab.gitlab-workflow", // GitLab CI/CD support
                // "ms-azuretools.vscode-docker", // Docker Support
                "tamasfe.even-better-toml", // TOML support
                "redhat.vscode-yaml", // YAML support
                "mhutchie.git-graph" // Git support
            ]
        }
    }
    // Uncomment to connect as root instead. More info: https://aka.ms/dev-containers-non-root.
    // "remoteUser": "root"
}
